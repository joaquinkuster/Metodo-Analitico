{% extends "layouts/base.html" %}
{% load form_tags %}

{% block title %} Generar Distribuciones {% endblock %}

{% block body %}
<div class="container-fluid py-4">
    <!-- Mensajes flash -->
    {% for message in messages %}
    {% if 'success' in message.tags %}
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    {% elif 'error' in message.tags %}
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    {% endif %}
    {% endfor %}

    <div class="row mb-3">
        <div class="col-12">
            <div class="card border-0 shadow-lg">
                <div class="card-header bg-primary text-white">
                    <div class="d-flex justify-content-between align-items-center">
                        <h2 class="h5 mb-0">
                            <i class="bi bi-list-columns-reverse me-2"></i>Ejemplo de distribucion exponencial
                        </h2>
                    </div>
                </div>
                <div class="card-body mt-0">
                    <div class="bg-light p-3 rounded">
                        <p class="text-muted">El tiempo de revisión del motor de un avión sigue una distribución exponencial con media 22 minutos. a) Encontrar la probabilidad de que el tiempo de revisión sea menor a 10 minutos. b) ¿Cuál es el tiempo de revisión de un motor superado por el 10% de los tiempos de revisión?. c) El costo de revisión es de 200 unidades monetarias fijas al que se le suma 10 unidades monetarias por el tiempo que dure la revisión. Encontrar la media y la varianza del costo.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <!-- Panel de Generación -->
        <div class="col-xxl-4 col-lg-6">
            <div class="card border-0 shadow-lg">
                <div class="card-header bg-primary text-white">
                    <h2 class="h5 mb-0">
                        <i class="bi bi-bar-chart-steps me-2"></i>Generar Distribución
                    </h2>
                </div>
                    <div class="card-body">
                        <!-- Selector de Distribución -->
                        <div class="mb-4">
                            <div class="btn-group w-100" role="group">
                                <button
                                    class="btn btn-primary"
                                    id="btnToggle1">
                                    Exponencial
                                </button>
                            </div>
                        </div>
                      <!-- Formulario Exponencial -->
                    <form method="post" action="{% url 'distribucion:generar' %}" id="formToggle2">
                        {% csrf_token %}
                        <input type="hidden" name="tipo_distribucion" value="EXP">
                        <div class="row g-3">
                            <div class="col-12">
                                <label for="{{ exponencial_form.tasa.id_for_label }}" class="form-label fw-bold">
                                    {{ exponencial_form.tasa.label }}</label>
                                {{ exponencial_form.tasa|add_class:"form-control" }}
                                {% if exponencial_form.tasa.errors %}
                                <div class="invalid-feedback d-block">{{ exponencial_form.tasa.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="d-grid mt-4">
                            <button type="submit" class="btn btn-success">
                                <i class="bi bi-play-circle me-2"></i>Generar Exponencial
                            </button>
                        </div>
                    </form>
                    </div>
            </div>
        </div>

        <!-- Resultados del Ejemplo -->
        <div class="col-xxl-8 col-lg-6">
            <div class="card border-0 shadow-lg h-100">
                <div class="card-header bg-primary text-white">
                    <div class="d-flex justify-content-between align-items-center">
                        <h2 class="h5 mb-0">
                            <i class="bi bi-list-columns-reverse me-2"></i>Resultados del ejemplo
                        </h2>
                    </div>
                </div>
                <div class="card-body">
                    <!-- Parámetros específicos -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <h5 class="fw-bold">Tasa <code>(λ)</code></h5>
                            <div class="bg-light p-3 rounded">
                                <p class="text-muted mb-0">{{ distribucion.exponencial.tasa }}</p>
                            </div>
                        </div>
                    </div>

                    <!-- Estadísticos -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <h5 class="fw-bold">Esperanza <code>E(x)</code></h5>
                            <div class="bg-light p-3 rounded">
                                <p class="text-muted mb-0">{{ distribucion.esperanza|floatformat:2 }}</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h5 class="fw-bold">Varianza <code>V(x)</code></h5>
                            <div class="bg-light p-3 rounded">
                                <p class="text-muted mb-0">{{ distribucion.varianza|floatformat:2 }}</p>
                            </div>
                        </div>
                    </div>

                    <!-- Valores de x -->
                    <div class="mb-4">
                        <h5 class="fw-bold">Marcas de clase</h5>
                        <div class="bg-light p-3 rounded">
                            <code>
                                {% for v in distribucion.valores_x %}
                                    {{ v|floatformat:1 }}{% if not forloop.last %}, {% endif %}
                                {% endfor %}
                            </code>
                        </div>
                    </div>

                    <!-- Valores de probabilidad -->
                    <div class="mb-4">
                        <h5 class="fw-bold">Probabilidades puntuales <code>f(x)</code></h5>
                        <div class="bg-light p-3 rounded">
                            <code>
                            {% for v in distribucion.valores_probabilidad %}
                                {{ v|floatformat:4 }}{% if not forloop.last %}, {% endif %}
                            {% endfor %}
                            </code>
                        </div>
                    </div>

                    <!-- Valores acumulados -->
                    <div class="mb-4">
                        <h5 class="fw-bold">Probabilidades acumuladas <code>F(x)</code></h5>
                        <div class="bg-light p-3 rounded">
                            <code>
                            {% for v in distribucion.valores_acumulados %}
                                {{ v|floatformat:4 }}{% if not forloop.last %}, {% endif %}
                            {% endfor %}
                            </code>
                        </div>
                    </div>

                    <!-- Fecha de creación -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <h5 class="fw-bold">Fecha de Creación</h5>
                            <div class="bg-light p-3 rounded">
                                <p class="text-muted mb-0">{{ distribucion.fecha_creacion|date:"d/m/Y H:i" }}</p>
                            </div>
                        </div>
                    </div>

                    <!-- Gráfico de densidad / probabilidad (PDF) -->
                    <div class="card mb-4">
                        <div class="card-body">
                            <h5 class="fw-bold">Función de densidad / probabilidad <code>f(x)</code></h5>
                            <p class="mb-2"><em>X</em> &sim; Exp(&lambda; = <strong>
                                    {{ distribucion.exponencial.tasa }}</strong>)</p>
                            <div id="grafico-pdf"></div>
                        </div>
                    </div>

                    <!-- Gráfico de distribución acumulada (CDF) -->
                    <div class="card mb-4">
                        <div class="card-body">
                            <h5 class="fw-bold">Función de distribución acumulada <code>F(x)</code></h5>
                            <p class="mb-2"><em>X</em> &sim; Exp(&lambda; = <strong>
                                    {{ distribucion.exponencial.tasa }}</strong>)</p>
                            <div id="grafico-cdf"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
